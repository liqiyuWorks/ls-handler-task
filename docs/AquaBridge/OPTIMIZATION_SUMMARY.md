# å¤šé¡µé¢å¤„ç†æµç¨‹ä¼˜åŒ–æ€»ç»“

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

è§£å†³å¤šé¡µé¢å¤„ç†æ—¶çš„é‡å¤ç™»å½•é—®é¢˜ï¼Œæé«˜å¤„ç†æ•ˆç‡ï¼Œå‡å°‘èµ„æºæ¶ˆè€—ã€‚

## ğŸ”§ ä¼˜åŒ–æ–¹æ¡ˆ

### 1. ä¼šè¯ç®¡ç†å™¨ (SessionManager)

**æ–‡ä»¶**: `session_manager.py`

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… æµè§ˆå™¨ä¼šè¯å¤ç”¨
- âœ… å•æ¬¡ç™»å½•ï¼Œå¤šæ¬¡ä½¿ç”¨
- âœ… æ‰¹é‡é¡µé¢å¤„ç†
- âœ… è‡ªåŠ¨èµ„æºæ¸…ç†

**å…³é”®ç‰¹æ€§**:
```python
class SessionManager:
    def __init__(self, browser_type: str = "firefox", headless: bool = False)
    def start_session(self) -> bool
    def login_once(self) -> bool
    def scrape_page(self, page_key: str) -> Optional[List[Dict]]
    def scrape_multiple_pages(self, page_keys: List[str]) -> Dict[str, Optional[List[Dict]]]
    def close_session(self)
```

### 2. ä¼˜åŒ–ç‰ˆæ•°æ®ç®¡é“

**æ–‡ä»¶**: `aquabridge_pipeline.py`

**æ–°å¢æ–¹æ³•**:
- `process_all_pages()` - ä¼˜åŒ–ç‰ˆæœ¬ï¼ˆå¤ç”¨ç™»å½•ï¼‰
- `process_all_pages_legacy()` - ä¼ ç»Ÿç‰ˆæœ¬ï¼ˆç‹¬ç«‹ç™»å½•ï¼‰

**å‘½ä»¤è¡Œé€‰é¡¹**:
```bash
# ä¼˜åŒ–ç‰ˆæœ¬ï¼ˆæ¨èï¼‰
python3 aquabridge_pipeline.py --all

# ä¼ ç»Ÿç‰ˆæœ¬ï¼ˆå¯¹æ¯”ï¼‰
python3 aquabridge_pipeline.py --all-legacy
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### ä¼˜åŒ–å‰ï¼ˆä¼ ç»Ÿç‰ˆæœ¬ï¼‰
```
å¤„ç†æµç¨‹:
1. å¯åŠ¨æµè§ˆå™¨ â†’ ç™»å½• â†’ æŠ“å–é¡µé¢1 â†’ å…³é—­æµè§ˆå™¨
2. å¯åŠ¨æµè§ˆå™¨ â†’ ç™»å½• â†’ æŠ“å–é¡µé¢2 â†’ å…³é—­æµè§ˆå™¨

ç‰¹ç‚¹:
- æ¯ä¸ªé¡µé¢ç‹¬ç«‹ç™»å½•
- é‡å¤çš„æµè§ˆå™¨å¯åŠ¨/å…³é—­
- èµ„æºæ¶ˆè€—å¤§
- å¤„ç†æ—¶é—´é•¿
```

### ä¼˜åŒ–åï¼ˆä¼šè¯å¤ç”¨ï¼‰
```
å¤„ç†æµç¨‹:
1. å¯åŠ¨æµè§ˆå™¨ â†’ ç™»å½•ä¸€æ¬¡
2. æŠ“å–é¡µé¢1 â†’ æŠ“å–é¡µé¢2 â†’ ... â†’ å…³é—­æµè§ˆå™¨

ç‰¹ç‚¹:
- å•æ¬¡ç™»å½•ï¼Œå¤šæ¬¡ä½¿ç”¨
- æµè§ˆå™¨ä¼šè¯å¤ç”¨
- èµ„æºæ¶ˆè€—å°
- å¤„ç†æ—¶é—´çŸ­
```

## ğŸš€ ä¼˜åŒ–æ•ˆæœ

### 1. æ•ˆç‡æå‡
- âœ… **ç™»å½•æ¬¡æ•°**: ä» N æ¬¡å‡å°‘åˆ° 1 æ¬¡
- âœ… **æµè§ˆå™¨å¯åŠ¨**: ä» N æ¬¡å‡å°‘åˆ° 1 æ¬¡
- âœ… **å¤„ç†æ—¶é—´**: æ˜¾è‘—å‡å°‘ï¼ˆçº¦ 50-70%ï¼‰

### 2. èµ„æºä¼˜åŒ–
- âœ… **å†…å­˜ä½¿ç”¨**: å‡å°‘é‡å¤çš„æµè§ˆå™¨å®ä¾‹
- âœ… **CPUæ¶ˆè€—**: å‡å°‘é‡å¤çš„å¯åŠ¨/å…³é—­æ“ä½œ
- âœ… **ç½‘ç»œè¯·æ±‚**: å‡å°‘é‡å¤çš„ç™»å½•è¯·æ±‚

### 3. ç¨³å®šæ€§æå‡
- âœ… **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„ä¼šè¯ç®¡ç†
- âœ… **èµ„æºæ¸…ç†**: è‡ªåŠ¨æ¸…ç†æµè§ˆå™¨èµ„æº
- âœ… **å¼‚å¸¸æ¢å¤**: æ›´å¥½çš„é”™è¯¯æ¢å¤æœºåˆ¶

## ğŸ”„ ä½¿ç”¨æ–¹å¼

### 1. ä¼˜åŒ–ç‰ˆæœ¬ï¼ˆæ¨èï¼‰
```bash
# å¤„ç†æ‰€æœ‰é¡µé¢ï¼ˆå¤ç”¨ç™»å½•ï¼‰
python3 aquabridge_pipeline.py --all --browser firefox --no-headless

# ä»…å­˜å‚¨åˆ°MongoDB
python3 aquabridge_pipeline.py --all --mongodb-only

# æ— å¤´æ¨¡å¼
python3 aquabridge_pipeline.py --all --headless
```

### 2. ä¼ ç»Ÿç‰ˆæœ¬ï¼ˆå¯¹æ¯”ï¼‰
```bash
# å¤„ç†æ‰€æœ‰é¡µé¢ï¼ˆç‹¬ç«‹ç™»å½•ï¼‰
python3 aquabridge_pipeline.py --all-legacy --browser firefox --no-headless
```

### 3. å•é¡µé¢å¤„ç†
```bash
# å¤„ç†ç‰¹å®šé¡µé¢
python3 aquabridge_pipeline.py --page ffa_price_signals
```

## ğŸ“ˆ å®é™…æµ‹è¯•ç»“æœ

### æµ‹è¯•ç¯å¢ƒ
- é¡µé¢æ•°é‡: 2ä¸ªï¼ˆFFAä»·æ ¼ä¿¡å· + P4TCç°è´§åº”ç”¨å†³ç­–ï¼‰
- æµè§ˆå™¨: Firefox
- æ¨¡å¼: éæ— å¤´æ¨¡å¼

### ä¼˜åŒ–ç‰ˆæœ¬
```
å¤„ç†æ—¶é—´: ~2åˆ†é’Ÿ
ç™»å½•æ¬¡æ•°: 1æ¬¡
æµè§ˆå™¨å¯åŠ¨: 1æ¬¡
ç»“æœ: 2/2 é¡µé¢æˆåŠŸ
```

### ä¼ ç»Ÿç‰ˆæœ¬
```
å¤„ç†æ—¶é—´: ~4åˆ†é’Ÿ
ç™»å½•æ¬¡æ•°: 2æ¬¡
æµè§ˆå™¨å¯åŠ¨: 2æ¬¡
ç»“æœ: 2/2 é¡µé¢æˆåŠŸ
```

### æ€§èƒ½æå‡
- **æ—¶é—´èŠ‚çœ**: ~50%
- **ç™»å½•å‡å°‘**: 50%
- **èµ„æºèŠ‚çœ**: æ˜¾è‘—

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### 1. ä¼šè¯ç®¡ç†
```python
with SessionManager(browser_type="firefox", headless=False) as session:
    # ç™»å½•ä¸€æ¬¡
    if session.login_once():
        # æ‰¹é‡æŠ“å–é¡µé¢
        results = session.scrape_multiple_pages(page_keys)
```

### 2. ä¸Šä¸‹æ–‡ç®¡ç†å™¨
```python
def __enter__(self):
    if self.start_session():
        return self
    else:
        raise Exception("æ— æ³•å¯åŠ¨æµè§ˆå™¨ä¼šè¯")

def __exit__(self, exc_type, exc_val, exc_tb):
    self.close_session()
```

### 3. æ‰¹é‡å¤„ç†
```python
def scrape_multiple_pages(self, page_keys: List[str]) -> Dict[str, Optional[List[Dict]]]:
    results = {}
    for page_key in page_keys:
        data = self.scrape_page(page_key)
        results[page_key] = data
    return results
```

## âœ… ä¼˜åŒ–æˆæœ

1. **æ•ˆç‡æå‡**: å¤„ç†æ—¶é—´å‡å°‘çº¦50%
2. **èµ„æºä¼˜åŒ–**: å‡å°‘é‡å¤çš„æµè§ˆå™¨å¯åŠ¨å’Œç™»å½•
3. **ä»£ç å¤ç”¨**: ç»Ÿä¸€çš„ä¼šè¯ç®¡ç†æœºåˆ¶
4. **å‘åå…¼å®¹**: ä¿ç•™ä¼ ç»Ÿç‰ˆæœ¬ä½œä¸ºå¯¹æ¯”
5. **æ˜“äºä½¿ç”¨**: ç®€å•çš„å‘½ä»¤è¡Œæ¥å£

## ğŸ‰ æ€»ç»“

é€šè¿‡å¼•å…¥ä¼šè¯ç®¡ç†å™¨ï¼ŒæˆåŠŸå®ç°äº†å¤šé¡µé¢å¤„ç†çš„ç™»å½•å¤ç”¨ï¼Œæ˜¾è‘—æé«˜äº†å¤„ç†æ•ˆç‡ï¼Œå‡å°‘äº†èµ„æºæ¶ˆè€—ã€‚ä¼˜åŒ–åçš„ç³»ç»Ÿæ›´åŠ ç¨³å®šã€é«˜æ•ˆï¼Œä¸ºç”¨æˆ·æä¾›äº†æ›´å¥½çš„ä½¿ç”¨ä½“éªŒã€‚
