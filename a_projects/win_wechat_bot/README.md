# å¾®ä¿¡ç¾¤ä¿¡æ¯ç›‘æ§ç³»ç»Ÿ

åŸºäº `wxauto` åº“å¼€å‘çš„å¾®ä¿¡ç¾¤æ¶ˆæ¯è·å–å’Œç›‘æ§ç³»ç»Ÿï¼Œå¯ä»¥å®æ—¶è·å–å¾®ä¿¡ç¾¤èŠçš„æ–‡æœ¬ä¿¡æ¯å¹¶è¿›è¡Œè¿‡æ»¤ã€ä¿å­˜å’Œå¯¼å‡ºã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” **ç¾¤èŠæ¶ˆæ¯è·å–**: è·å–æŒ‡å®šç¾¤èŠçš„æœ€æ–°æ¶ˆæ¯
- ğŸ“ **æ¶ˆæ¯è¿‡æ»¤**: æ”¯æŒå…³é”®è¯è¿‡æ»¤ã€å‘é€è€…è¿‡æ»¤ç­‰
- ğŸ’¾ **æ¶ˆæ¯ä¿å­˜**: è‡ªåŠ¨ä¿å­˜æ¶ˆæ¯åˆ°JSONæ–‡ä»¶
- ğŸ“Š **æ¶ˆæ¯å¯¼å‡º**: æ”¯æŒå¯¼å‡ºä¸ºCSVæ ¼å¼
- ğŸ” **æ¶ˆæ¯æœç´¢**: åœ¨å†å²æ¶ˆæ¯ä¸­æœç´¢å…³é”®è¯
- ğŸ“ˆ **å®æ—¶ç›‘æ§**: æŒç»­ç›‘æ§æŒ‡å®šç¾¤èŠçš„æ–°æ¶ˆæ¯
- âš™ï¸ **çµæ´»é…ç½®**: é€šè¿‡é…ç½®æ–‡ä»¶è‡ªå®šä¹‰ç›‘æ§è¡Œä¸º
- ğŸ› ï¸ **ç¾¤èŠç®¡ç†**: åŠ¨æ€æ·»åŠ /ç§»é™¤ç›‘æ§ç¾¤èŠ
- ğŸ¯ **å›¾å½¢ç•Œé¢**: æä¾›äº¤äº’å¼ç¾¤èŠç®¡ç†å·¥å…·

## å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

ä¸»è¦ä¾èµ–ï¼š
- `wxauto>=3.9.0` - å¾®ä¿¡è‡ªåŠ¨åŒ–åº“
- `dataclasses-json>=0.6.0` - æ•°æ®ç±»JSONæ”¯æŒ

## å¿«é€Ÿå¼€å§‹

### 1. ä½¿ç”¨ç¾¤èŠç®¡ç†å·¥å…·ï¼ˆæ¨èï¼‰

```bash
python group_manager.py
```

è¿™æ˜¯ä¸€ä¸ªäº¤äº’å¼å·¥å…·ï¼Œæä¾›å›¾å½¢åŒ–èœå•æ¥ç®¡ç†ç¾¤èŠå’Œç›‘æ§ã€‚

### 1.1 ä½¿ç”¨é…ç½®ç®¡ç†å·¥å…·

```bash
python config_manager.py
```

ä¸“é—¨ç”¨äºç®¡ç†é…ç½®æ–‡ä»¶ï¼ŒåŒ…æ‹¬ç¾¤èŠåˆ—è¡¨ã€è¿‡æ»¤æ¡ä»¶ç­‰ã€‚

### 2. è¿è¡Œå¿«é€Ÿå¼€å§‹è„šæœ¬

```bash
python quick_start.py
```

### 3. æŸ¥çœ‹ä½¿ç”¨ç¤ºä¾‹

```bash
python example.py
```

### 4. åŸºæœ¬ä½¿ç”¨

```python
from wechat_monitor import WeChatGroupMonitor

# åˆ›å»ºç›‘æ§å™¨
monitor = WeChatGroupMonitor()

# è¿æ¥å¾®ä¿¡å®¢æˆ·ç«¯
if monitor.connect_wechat():
    # è·å–ç¾¤èŠåˆ—è¡¨
    groups = monitor.get_group_list()
    print(f"æ‰¾åˆ° {len(groups)} ä¸ªç¾¤èŠ")
    
    # æ·»åŠ ç›‘æ§ç¾¤èŠ
    if groups:
        monitor.add_monitor_group(groups[0])
        
        # è·å–æ¶ˆæ¯
        messages = monitor.get_group_messages(groups[0], limit=10)
        for msg in messages:
            print(f"{msg.sender}: {msg.content}")
```

## é…ç½®æ–‡ä»¶è¯´æ˜

`config.json` é…ç½®æ–‡ä»¶åŒ…å«ä»¥ä¸‹é€‰é¡¹ï¼š

```json
{
  "monitor_groups": ["win_wechat_bot_test"],  // è¦ç›‘æ§çš„ç¾¤èŠåç§°åˆ—è¡¨
  "save_messages": true,                      // æ˜¯å¦ä¿å­˜æ¶ˆæ¯åˆ°æ–‡ä»¶
  "output_dir": "messages",                   // æ¶ˆæ¯ä¿å­˜ç›®å½•
  "log_level": "INFO",                        // æ—¥å¿—çº§åˆ«
  "check_interval": 10,                       // æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
  "max_messages_per_file": 1000,              // æ¯ä¸ªæ–‡ä»¶æœ€å¤§æ¶ˆæ¯æ•°
  "message_filters": {
    "keywords": [],                           // å…³é”®è¯è¿‡æ»¤ï¼ˆåªä¿ç•™åŒ…å«è¿™äº›è¯çš„æ¶ˆæ¯ï¼‰
    "exclude_keywords": [                     // æ’é™¤å…³é”®è¯
      "æ’¤å›äº†ä¸€æ¡æ¶ˆæ¯",
      "æ‹äº†æ‹",
      "åŠ å…¥äº†ç¾¤èŠ",
      "é€€å‡ºäº†ç¾¤èŠ"
    ],
    "sender_whitelist": [],                   // å‘é€è€…ç™½åå•
    "sender_blacklist": []                    // å‘é€è€…é»‘åå•
  },
  "auto_save": true,                          // è‡ªåŠ¨ä¿å­˜
  "export_format": "json"                     // å¯¼å‡ºæ ¼å¼
}
```

### é…ç½®æ–‡ä»¶ç®¡ç†

1. **ç›´æ¥ç¼–è¾‘**: æ‰‹åŠ¨ç¼–è¾‘ `config.json` æ–‡ä»¶
2. **ä½¿ç”¨é…ç½®ç®¡ç†å·¥å…·**: è¿è¡Œ `python config_manager.py`
3. **ç¨‹åºåŒ–ç®¡ç†**: ä½¿ç”¨ `monitor.add_monitor_group()` ç­‰æ–¹æ³•
4. **é‡æ–°åŠ è½½é…ç½®**: ä½¿ç”¨ `monitor.reload_config()` æ–¹æ³•

## ä¸»è¦åŠŸèƒ½

### 1. ç¾¤èŠç®¡ç†

```python
# æ·»åŠ ç›‘æ§ç¾¤èŠ
monitor.add_monitor_group("ç¾¤èŠåç§°")

# ç§»é™¤ç›‘æ§ç¾¤èŠ
monitor.remove_monitor_group("ç¾¤èŠåç§°")

# è·å–ç›‘æ§åˆ—è¡¨
monitored_groups = monitor.get_monitor_groups()

# é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶
monitor.reload_config()
```

### 2. è·å–ç¾¤èŠæ¶ˆæ¯

```python
# è·å–æŒ‡å®šç¾¤èŠçš„æœ€æ–°æ¶ˆæ¯
messages = monitor.get_group_messages("ç¾¤èŠåç§°", limit=50)

# è·å–æ‰€æœ‰ç¾¤èŠåˆ—è¡¨
groups = monitor.get_group_list()
```

### 3. æ¶ˆæ¯æœç´¢

```python
# æœç´¢åŒ…å«å…³é”®è¯çš„æ¶ˆæ¯
matched_messages = monitor.search_messages("å…³é”®è¯", "ç¾¤èŠåç§°")
```

### 4. æ¶ˆæ¯å¯¼å‡º

```python
# å¯¼å‡ºæ¶ˆæ¯åˆ°CSVæ–‡ä»¶
monitor.export_messages_to_csv(messages, "output.csv")
```

### 5. å®æ—¶ç›‘æ§

```python
# å¼€å§‹ç›‘æ§é…ç½®çš„ç¾¤èŠ
monitor.start_monitoring()
```

## ä½¿ç”¨æ³¨æ„äº‹é¡¹

### ç¯å¢ƒè¦æ±‚

1. **Windowsç³»ç»Ÿ**: wxautoåº“ä»…æ”¯æŒWindowsç³»ç»Ÿ
2. **å¾®ä¿¡å®¢æˆ·ç«¯**: éœ€è¦å®‰è£…å¹¶ç™»å½•å¾®ä¿¡PCç‰ˆå®¢æˆ·ç«¯
3. **Pythonç‰ˆæœ¬**: å»ºè®®ä½¿ç”¨Python 3.7+

### ä½¿ç”¨å‰å‡†å¤‡

1. ç¡®ä¿å¾®ä¿¡PCç‰ˆå®¢æˆ·ç«¯å·²æ‰“å¼€å¹¶ç™»å½•
2. å®‰è£…å¿…è¦çš„Pythonä¾èµ–åŒ…
3. æ ¹æ®éœ€è¦ä¿®æ”¹ `config.json` é…ç½®æ–‡ä»¶

### å®‰å…¨æé†’

- æœ¬å·¥å…·ä»…ç”¨äºä¸ªäººå­¦ä¹ å’Œç ”ç©¶ç›®çš„
- è¯·éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„å’Œå¾®ä¿¡ä½¿ç”¨æ¡æ¬¾
- ä¸è¦ç”¨äºå•†ä¸šç”¨é€”æˆ–ä¾µçŠ¯ä»–äººéšç§
- å»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨

## æ–‡ä»¶ç»“æ„

```
win_wechat_bot/
â”œâ”€â”€ wechat_monitor.py         # ä¸»è¦ç›‘æ§æ¨¡å—
â”œâ”€â”€ group_manager.py          # ç¾¤èŠç®¡ç†å·¥å…·
â”œâ”€â”€ config_manager.py         # é…ç½®ç®¡ç†å·¥å…·
â”œâ”€â”€ config.json               # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt          # ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ quick_start.py           # å¿«é€Ÿå¼€å§‹è„šæœ¬
â”œâ”€â”€ example.py               # ä½¿ç”¨ç¤ºä¾‹
â”œâ”€â”€ README.md                # è¯´æ˜æ–‡æ¡£
â””â”€â”€ messages/                # æ¶ˆæ¯ä¿å­˜ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
```

## é—®é¢˜ä¿®å¤

### ä¿®å¤äº† wxauto å…¼å®¹æ€§é—®é¢˜

åŸç‰ˆæœ¬å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
- `'TimeMessage' object has no attribute 'get'` é”™è¯¯
- æ— æ³•æ­£ç¡®è·å–ç¾¤èŠåˆ—è¡¨
- æ¶ˆæ¯å¯¹è±¡å±æ€§è®¿é—®é”™è¯¯

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
1. ä¼˜åŒ–äº† `wechat_monitor.py` ä¸»æ¨¡å—
2. ä½¿ç”¨ `GetContactGroups()` æ–¹æ³•è·å–ç¾¤èŠåˆ—è¡¨
3. æ”¹è¿›äº†æ¶ˆæ¯å¯¹è±¡çš„å±æ€§è®¿é—®æ–¹å¼
4. æ·»åŠ äº†å¤šç§è·å–ç¾¤èŠçš„æ–¹æ³•ä½œä¸ºå¤‡é€‰
5. å¢å¼ºäº†é”™è¯¯å¤„ç†å’Œå…¼å®¹æ€§
6. æ·»åŠ äº†ç¾¤èŠç®¡ç†åŠŸèƒ½

### ä½¿ç”¨ä¼˜åŒ–åçš„ç‰ˆæœ¬

```python
# ä½¿ç”¨ä¼˜åŒ–åçš„ç‰ˆæœ¬
from wechat_monitor import WeChatGroupMonitor

monitor = WeChatGroupMonitor()
```

## å¸¸è§é—®é¢˜

### Q: è¿æ¥å¾®ä¿¡å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: è¯·æ£€æŸ¥ï¼š
1. å¾®ä¿¡PCç‰ˆå®¢æˆ·ç«¯æ˜¯å¦å·²æ‰“å¼€å¹¶ç™»å½•
2. æ˜¯å¦å·²æ­£ç¡®å®‰è£…wxautoåº“
3. å¾®ä¿¡ç‰ˆæœ¬æ˜¯å¦è¿‡æ—§ï¼ˆå»ºè®®ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ï¼‰

### Q: è·å–ä¸åˆ°ç¾¤èŠæ¶ˆæ¯ï¼Ÿ

A: å¯èƒ½çš„åŸå› ï¼š
1. ç¾¤èŠåç§°é…ç½®é”™è¯¯
2. ç¾¤èŠæƒé™ä¸è¶³
3. ç½‘ç»œè¿æ¥é—®é¢˜
4. ä½¿ç”¨æ—§ç‰ˆæœ¬ä»£ç ï¼ˆè¯·ä½¿ç”¨ `wechat_monitor.py`ï¼‰

### Q: å‡ºç° 'TimeMessage' object has no attribute 'get' é”™è¯¯ï¼Ÿ

A: è¿™æ˜¯ wxauto åº“å…¼å®¹æ€§é—®é¢˜ï¼Œè¯·ä½¿ç”¨ä¼˜åŒ–åçš„ç‰ˆæœ¬ï¼š
```bash
python group_manager.py  # ä½¿ç”¨ç¾¤èŠç®¡ç†å·¥å…·
python wechat_monitor.py  # ä½¿ç”¨ä¼˜åŒ–åçš„ç‰ˆæœ¬
```

### Q: å¦‚ä½•æ·»åŠ æ–°çš„è¿‡æ»¤æ¡ä»¶ï¼Ÿ

A: ä¿®æ”¹ `config.json` ä¸­çš„ `message_filters` éƒ¨åˆ†ï¼Œæ·»åŠ ç›¸åº”çš„å…³é”®è¯æˆ–å‘é€è€…åˆ—è¡¨ã€‚

## å¼€å‘è¯´æ˜

### æ‰©å±•åŠŸèƒ½

å¯ä»¥é€šè¿‡ç»§æ‰¿ `WeChatGroupMonitor` ç±»æ¥æ·»åŠ è‡ªå®šä¹‰åŠŸèƒ½ï¼š

```python
class CustomMonitor(WeChatGroupMonitor):
    def custom_message_handler(self, message):
        # è‡ªå®šä¹‰æ¶ˆæ¯å¤„ç†é€»è¾‘
        pass
```

### æ¶ˆæ¯æ•°æ®ç»“æ„

```python
@dataclass
class GroupMessage:
    timestamp: str      # æ—¶é—´æˆ³
    sender: str         # å‘é€è€…
    content: str        # æ¶ˆæ¯å†…å®¹
    group_name: str     # ç¾¤èŠåç§°
    message_type: str   # æ¶ˆæ¯ç±»å‹
    raw_data: Dict      # åŸå§‹æ•°æ®
```

## è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ï¼Œè¯·éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ã€‚

## æ›´æ–°æ—¥å¿—

- v1.0.0: åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒåŸºæœ¬çš„ç¾¤èŠæ¶ˆæ¯è·å–å’Œç›‘æ§åŠŸèƒ½
