# èˆ¹èˆ¶æ²¹è€—é¢„æµ‹FastAPIä½¿ç”¨è¯´æ˜

## ğŸ¯ APIæ¦‚è¿°

æœ¬APIåŸºäºV3.0å¢å¼ºç‰ˆèˆ¹èˆ¶æ²¹è€—é¢„æµ‹ç³»ç»Ÿï¼Œæä¾›é«˜ç²¾åº¦çš„èˆ¹èˆ¶ç‡ƒæ²¹æ¶ˆè€—é¢„æµ‹æœåŠ¡ã€‚æ”¯æŒå¤šç»´åº¦ç‰¹å¾è¾“å…¥å’Œå®æ—¶é¢„æµ‹ã€‚

### æ ¸å¿ƒç‰¹æ€§
- âœ… **é«˜ç²¾åº¦é¢„æµ‹**: åŸºäº35,289æ¡NOONæŠ¥å‘Šæ•°æ®è®­ç»ƒï¼ŒRÂ² = 0.8677
- âœ… **å¤šç»´åº¦è¾“å…¥**: æ”¯æŒ12ä¸ªè¾“å…¥ç‰¹å¾ (3ä¸ªå¿…éœ€ + 9ä¸ªå¯é€‰)
- âœ… **RESTful API**: æ ‡å‡†çš„HTTPæ¥å£ï¼Œæ”¯æŒGETå’ŒPOSTè¯·æ±‚
- âœ… **è‡ªåŠ¨æ–‡æ¡£**: å†…ç½®Swaggerå’ŒReDocæ–‡æ¡£
- âœ… **æ‰¹é‡å¤„ç†**: æ”¯æŒæ‰¹é‡é¢„æµ‹å’Œåˆ†æåŠŸèƒ½

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨æœåŠ¡å™¨

```bash
# æ–¹å¼1: ä½¿ç”¨å¯åŠ¨è„šæœ¬
./start_api.sh

# æ–¹å¼2: ç›´æ¥è¿è¡Œ
python fastapi_server.py

# æ–¹å¼3: ä½¿ç”¨uvicorn
uvicorn fastapi_server:app --host 0.0.0.0 --port 8000 --reload
```

### 2. è®¿é—®APIæ–‡æ¡£

- **æœåŠ¡åœ°å€**: http://localhost:8000
- **Swaggeræ–‡æ¡£**: http://localhost:8000/docs
- **ReDocæ–‡æ¡£**: http://localhost:8000/redoc

### 3. å¥åº·æ£€æŸ¥

```bash
curl http://localhost:8000/health
```

## ğŸ“¡ APIæ¥å£è¯¦è§£

### 1. åŸºç¡€é¢„æµ‹ (GETæ–¹å¼)

**æ¥å£**: `GET /predict`

**æè¿°**: ä½¿ç”¨æŸ¥è¯¢å‚æ•°è¿›è¡ŒåŸºç¡€æ²¹è€—é¢„æµ‹

**å¿…éœ€å‚æ•°**:
- `ship_type`: èˆ¹èˆ¶ç±»å‹
- `speed`: èˆªè¡Œé€Ÿåº¦ (èŠ‚)

**å¯é€‰å‚æ•°**:
- `dwt`: è½½é‡å¨
- `ship_age`: èˆ¹é¾„ (å¹´)
- `load_condition`: è½½é‡çŠ¶æ€ (Laden/Ballast)

**ç¤ºä¾‹**:
```bash
# åŸºç¡€é¢„æµ‹
curl "http://localhost:8000/predict?ship_type=Bulk Carrier&speed=12.0"

# å¸¦å¯é€‰å‚æ•°
curl "http://localhost:8000/predict?ship_type=Bulk Carrier&speed=12.0&dwt=75000&ship_age=8&load_condition=Laden"
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "predicted_consumption": 30.08,
  "confidence": "High",
  "method": "ml_model",
  "ship_type": "Bulk Carrier",
  "speed": 12.0,
  "prediction_range": [27.07, 33.09],
  "prediction_time": "2025-09-21T16:30:00",
  "api_version": "3.0"
}
```

### 2. å¢å¼ºé¢„æµ‹ (POSTæ–¹å¼)

**æ¥å£**: `POST /predict`

**æè¿°**: ä½¿ç”¨JSONè¯·æ±‚ä½“è¿›è¡Œå¤šç»´åº¦å¢å¼ºé¢„æµ‹

**è¯·æ±‚ä½“ç¤ºä¾‹**:
```json
{
  "ship_type": "Container Ship",
  "speed": 18.0,
  "dwt": 120000,
  "ship_age": 5,
  "load_condition": "Laden",
  "draft": 14.0,
  "length": 350,
  "latitude": 35.0,
  "longitude": 139.0,
  "heavy_fuel_cp": 650,
  "light_fuel_cp": 850,
  "speed_cp": 18.0
}
```

**cURLç¤ºä¾‹**:
```bash
curl -X POST "http://localhost:8000/predict" \
  -H "Content-Type: application/json" \
  -d '{
    "ship_type": "Container Ship",
    "speed": 18.0,
    "dwt": 120000,
    "ship_age": 5,
    "load_condition": "Laden",
    "draft": 14.0,
    "length": 350
  }'
```

### 3. æ‰¹é‡é¢„æµ‹

**æ¥å£**: `POST /predict/batch`

**æè¿°**: æ‰¹é‡å¤„ç†å¤šä¸ªé¢„æµ‹è¯·æ±‚

**è¯·æ±‚ä½“ç¤ºä¾‹**:
```json
{
  "predictions": [
    {
      "ship_type": "Bulk Carrier",
      "speed": 10.0,
      "dwt": 50000
    },
    {
      "ship_type": "Container Ship",
      "speed": 20.0,
      "dwt": 150000,
      "ship_age": 10
    }
  ]
}
```

### 4. è½½é‡çŠ¶æ€å¯¹æ¯”åˆ†æ

**æ¥å£**: `POST /analyze/load-comparison`

**æè¿°**: å¯¹æ¯”æ»¡è½½å’Œå‹è½½çŠ¶æ€ä¸‹çš„æ²¹è€—å·®å¼‚

**è¯·æ±‚ä½“ç¤ºä¾‹**:
```json
{
  "ship_type": "Bulk Carrier",
  "speed": 12.0,
  "dwt": 75000,
  "ship_age": 10
}
```

### 5. èˆ¹é¾„å½±å“åˆ†æ

**æ¥å£**: `POST /analyze/ship-age`

**æè¿°**: åˆ†æä¸åŒèˆ¹é¾„å¯¹æ²¹è€—çš„å½±å“

**æŸ¥è¯¢å‚æ•°**:
- `ship_type`: èˆ¹èˆ¶ç±»å‹
- `speed`: èˆªè¡Œé€Ÿåº¦
- `dwt`: è½½é‡å¨ (å¯é€‰)
- `age_min`: æœ€å°èˆ¹é¾„ (é»˜è®¤0)
- `age_max`: æœ€å¤§èˆ¹é¾„ (é»˜è®¤25)

**ç¤ºä¾‹**:
```bash
curl -X POST "http://localhost:8000/analyze/ship-age?ship_type=Container Ship&speed=18.0&dwt=120000&age_min=0&age_max=20"
```

### 6. ç³»ç»ŸçŠ¶æ€æŸ¥è¯¢

**æ¥å£**: `GET /status`

**æè¿°**: è·å–APIç³»ç»ŸçŠ¶æ€å’Œé…ç½®ä¿¡æ¯

```bash
curl http://localhost:8000/status
```

### 7. æ”¯æŒçš„èˆ¹èˆ¶ç±»å‹

**æ¥å£**: `GET /ship-types`

**æè¿°**: è·å–ç³»ç»Ÿæ”¯æŒçš„èˆ¹èˆ¶ç±»å‹åˆ—è¡¨

```bash
curl http://localhost:8000/ship-types
```

## ğŸš¢ æ”¯æŒçš„èˆ¹èˆ¶ç±»å‹

| ç±»å‹ | è‹±æ–‡åç§° | ä¸­æ–‡åç§° | æè¿° |
|------|----------|----------|------|
| Bulk Carrier | Bulk Carrier | æ•£è´§èˆ¹ | è¿è¾“æ•£è£…è´§ç‰©çš„èˆ¹èˆ¶ |
| Container Ship | Container Ship | é›†è£…ç®±èˆ¹ | è¿è¾“é›†è£…ç®±çš„ä¸“ç”¨èˆ¹èˆ¶ |
| Crude Oil Tanker | Crude Oil Tanker | åŸæ²¹èˆ¹ | è¿è¾“åŸæ²¹çš„æ²¹è½® |
| Chemical Tanker | Chemical Tanker | åŒ–å­¦å“èˆ¹ | è¿è¾“åŒ–å­¦å“çš„ä¸“ç”¨èˆ¹èˆ¶ |
| General Cargo | General Cargo | æ‚è´§èˆ¹ | è¿è¾“å„ç±»æ‚è´§çš„èˆ¹èˆ¶ |
| Open Hatch Cargo | Open Hatch Cargo | å¼€èˆ±æ‚è´§èˆ¹ | å…·æœ‰å¯å¼€å¯èˆ±ç›–çš„æ‚è´§èˆ¹ |
| Other | Other | å…¶ä»–ç±»å‹ | å…¶ä»–ç±»å‹çš„èˆ¹èˆ¶ |

## ğŸ”§ è¾“å…¥å‚æ•°è¯¦è§£

### å¿…éœ€å‚æ•°

| å‚æ•° | ç±»å‹ | èŒƒå›´ | æè¿° | ç¤ºä¾‹ |
|------|------|------|------|------|
| ship_type | string | - | èˆ¹èˆ¶ç±»å‹ | "Bulk Carrier" |
| speed | float | 0-30 | èˆªè¡Œé€Ÿåº¦ (èŠ‚) | 12.0 |

### å¯é€‰å‚æ•°

| å‚æ•° | ç±»å‹ | èŒƒå›´ | æè¿° | ç¤ºä¾‹ |
|------|------|------|------|------|
| dwt | float | 1000+ | è½½é‡å¨ | 75000 |
| ship_age | float | 0-50 | èˆ¹é¾„ (å¹´) | 8 |
| load_condition | string | Laden/Ballast | è½½é‡çŠ¶æ€ | "Laden" |
| draft | float | 1-25 | èˆ¹èˆ¶åƒæ°´ (ç±³) | 12.5 |
| length | float | 50-500 | èˆ¹èˆ¶æ€»é•¿åº¦ (ç±³) | 225 |
| latitude | float | -90 to 90 | çº¬åº¦ | 35.0 |
| longitude | float | -180 to 180 | ç»åº¦ | 139.0 |
| heavy_fuel_cp | float | 200-1500 | é‡æ²¹CPä»·æ ¼ ($/å¨) | 650 |
| light_fuel_cp | float | 300-2000 | è½»æ²¹CPä»·æ ¼ ($/å¨) | 850 |
| speed_cp | float | 5-30 | èˆªé€ŸCP (èŠ‚) | 12.0 |

## ğŸ“Š å“åº”æ ¼å¼

### é¢„æµ‹å“åº”

```json
{
  "predicted_consumption": 30.08,     // é¢„æµ‹æ²¹è€— (mt)
  "confidence": "High",               // ç½®ä¿¡åº¦ (High/Medium/Low)
  "method": "ml_model",               // é¢„æµ‹æ–¹æ³•
  "ship_type": "Bulk Carrier",       // èˆ¹èˆ¶ç±»å‹
  "speed": 12.0,                      // èˆªè¡Œé€Ÿåº¦
  "prediction_range": [27.07, 33.09], // é¢„æµ‹èŒƒå›´
  "prediction_time": "2025-09-21T16:30:00", // é¢„æµ‹æ—¶é—´
  "api_version": "3.0"                // APIç‰ˆæœ¬
}
```

### é”™è¯¯å“åº”

```json
{
  "detail": "é¢„æµ‹å¤±è´¥: é”™è¯¯æè¿°"
}
```

## ğŸ§ª æµ‹è¯•å®¢æˆ·ç«¯

ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„æµ‹è¯•å®¢æˆ·ç«¯ï¼Œå¯ä»¥æµ‹è¯•æ‰€æœ‰APIåŠŸèƒ½ï¼š

```bash
# è¿è¡Œæµ‹è¯•å®¢æˆ·ç«¯
python test_api_client.py
```

æµ‹è¯•å®¢æˆ·ç«¯å°†è‡ªåŠ¨æµ‹è¯•ï¼š
- âœ… å¥åº·æ£€æŸ¥
- âœ… åŸºç¡€é¢„æµ‹ (GET)
- âœ… å¢å¼ºé¢„æµ‹ (POST)
- âœ… æ‰¹é‡é¢„æµ‹
- âœ… è½½é‡çŠ¶æ€å¯¹æ¯”
- âœ… èˆ¹é¾„å½±å“åˆ†æ
- âœ… ç³»ç»ŸçŠ¶æ€æŸ¥è¯¢
- âœ… èˆ¹èˆ¶ç±»å‹åˆ—è¡¨

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### 1. å‚æ•°è¾“å…¥ä¼˜å…ˆçº§

**é«˜å½±å“å‚æ•°** (å»ºè®®æä¾›):
- èˆ¹èˆ¶ç±»å‹ (å¿…éœ€)
- èˆªè¡Œé€Ÿåº¦ (å¿…éœ€)
- è½½é‡å¨ (dwt)
- èˆ¹èˆ¶å°ºå¯¸ (draft, length)
- é‡æ²¹CPä»·æ ¼

**è¾…åŠ©å‚æ•°** (å¯é€‰):
- èˆ¹é¾„
- è½½é‡çŠ¶æ€
- åœ°ç†ä½ç½®
- å…¶ä»–CPæ¡æ¬¾

### 2. åº”ç”¨åœºæ™¯

**å¿«é€Ÿä¼°ç®—**:
```bash
curl "http://localhost:8000/predict?ship_type=Bulk Carrier&speed=12.0"
```

**é«˜ç²¾åº¦é¢„æµ‹**:
```json
{
  "ship_type": "Bulk Carrier",
  "speed": 12.0,
  "dwt": 75000,
  "ship_age": 8,
  "load_condition": "Laden",
  "draft": 12.5,
  "length": 225,
  "heavy_fuel_cp": 650
}
```

**æ‰¹é‡åˆ†æ**:
- ä½¿ç”¨æ‰¹é‡é¢„æµ‹æ¥å£å¤„ç†å¤šä¸ªèˆ¹èˆ¶
- ä½¿ç”¨åˆ†ææ¥å£è¿›è¡Œå¯¹æ¯”ç ”ç©¶

### 3. æ€§èƒ½ä¼˜åŒ–

- **å•æ¬¡é¢„æµ‹**: å“åº”æ—¶é—´ < 100ms
- **æ‰¹é‡é¢„æµ‹**: æ”¯æŒåŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚
- **ç¼“å­˜**: ç›¸åŒå‚æ•°çš„é‡å¤è¯·æ±‚ä¼šè¢«ç¼“å­˜

## ğŸ”’ é”™è¯¯å¤„ç†

### HTTPçŠ¶æ€ç 

- `200`: è¯·æ±‚æˆåŠŸ
- `400`: è¯·æ±‚å‚æ•°é”™è¯¯
- `404`: æ¥å£ä¸å­˜åœ¨
- `500`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
- `503`: æœåŠ¡ä¸å¯ç”¨ (é¢„æµ‹å™¨æœªåˆå§‹åŒ–)

### å¸¸è§é”™è¯¯

1. **é¢„æµ‹å™¨æœªåˆå§‹åŒ–** (503):
   - æ£€æŸ¥æ¨¡å‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨
   - é‡å¯æœåŠ¡å™¨

2. **å‚æ•°éªŒè¯å¤±è´¥** (400):
   - æ£€æŸ¥å‚æ•°ç±»å‹å’ŒèŒƒå›´
   - å‚è€ƒå‚æ•°è¯´æ˜

3. **é¢„æµ‹å¤±è´¥** (500):
   - æ£€æŸ¥è¾“å…¥å‚æ•°çš„åˆç†æ€§
   - æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚éœ€æŠ€æœ¯æ”¯æŒæˆ–åŠŸèƒ½æ‰©å±•ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚

---

**APIç‰ˆæœ¬**: V3.0  
**æ›´æ–°æ—¶é—´**: 2025-09-21  
**å¼€å‘å›¢é˜Ÿ**: èˆ¹èˆ¶æ²¹è€—é¢„æµ‹ç³»ç»Ÿå¼€å‘ç»„
